(window.webpackJsonp=window.webpackJsonp||[]).push([[68],{168:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return s})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return f}));var r=n(1),a=n(6),o=(n(0),n(254)),i=n(256),s={id:"unit-testing-vector-config-files",title:"Unit Testing Your Vector Config Files",description:"Treating your Vector configuration files as code",author_id:"ashley",tags:["type: announcement","domain: config"]},c={permalink:"/blog/unit-testing-vector-config-files",source:"@site/blog/2019-11-25-unit-testing-vector-config-files.md",description:"Treating your Vector configuration files as code",date:"2019-11-25T00:00:00.000Z",tags:[{label:"type: announcement",permalink:"/blog/tags/type-announcement"},{label:"domain: config",permalink:"/blog/tags/domain-config"}],title:"Unit Testing Your Vector Config Files",nextItem:{title:"Windows Support Is Here!",permalink:"/blog/windows-support"}},l=[{value:"Example",id:"example",children:[]},{value:"Why?",id:"why",children:[]},{value:"Getting Started",id:"getting-started",children:[]},{value:"Feedback",id:"feedback",children:[]}],p={rightToc:l},u="wrapper";function f(e){var t=e.components,n=Object(a.a)(e,["components"]);return Object(o.b)(u,Object(r.a)({},p,n,{components:t,mdxType:"MDXLayout"}),Object(o.b)("p",null,"Today we're excited to announce beta support for unit testing Vector\nconfigurations, allowing you to define tests directly within your Vector\nconfiguration file. These tests are used to assert the output from topologies of\n",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/reference/transforms/"}),"transform")," components given certain input events, ensuring\nthat your configuration behavior does not regress; a very powerful feature for\nmission-critical production pipelines that are collaborated on."),Object(o.b)("h2",{id:"example"},"Example"),Object(o.b)("p",null,"Let's look at a basic example that uses the ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/reference/transforms/regex_parser/"}),Object(o.b)("inlineCode",{parentName:"a"},"regex_parser"),"\ntransform")," to parse log lines:"),Object(o.b)(i.a,{fileName:"vector.toml",mdxType:"CodeHeader"}),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-toml"}),'[sources.my_logs]\n  type    = "file"\n  include = ["/var/log/my-app.log"]\n\n[transforms.parser]\n  inputs = ["my_logs"]\n  type   = "regex_parser"\n  regex  = "^(?P<timestamp>[\\\\w\\\\-:\\\\+]+) (?P<level>\\\\w+) (?P<message>.*)$"\n\n[[tests]]\n  name = "verify_regex"\n\n  [tests.input]\n    insert_at = "parser"\n    type = "raw"\n    value = "2019-11-28T12:00:00+00:00 info Hello world"\n\n  [[tests.outputs]]\n    extract_from = "parser"\n\n    [[tests.outputs.conditions]]\n      type = "check_fields"\n      "timestamp.equals" = "2019-11-28T12:00:00+00:00"\n      "level.equals" = "info"\n      "message.equals" = "Hello world"\n')),Object(o.b)("p",null,"And you can run the tests via the new ",Object(o.b)("inlineCode",{parentName:"p"},"test")," subcommand:"),Object(o.b)("pre",null,Object(o.b)("code",Object(r.a)({parentName:"pre"},{className:"language-sh"}),"$ vector test ./vector.toml\nRunning ./vector.toml tests\nTest ./vector.toml: verify_regex ... passed\n")),Object(o.b)("h2",{id:"why"},"Why?"),Object(o.b)("p",null,"Many Vector configurations will be simple transformations across straight\nforward pipelines (such as ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/reference/sources/file/"}),"tailing a file")," and piping the\ndata to ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/reference/sinks/aws_cloudwatch_logs/"}),"AWS CloudWatch Logs"),") and don't really\nneed protection from regressions. However, Vector configs are capable of\nexpanding indefinitely with ",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/reference/transforms/"}),"transforms")," in order to solve as\nmuch of your processing needs as possible."),Object(o.b)("p",null,"As a config grows, and as the number of owners of a config grow, the potential\nfor regressions also grows just like a regular codebase. The lack of testing\ncapabilities of configuration driven services is therefore a common pain for\nlarger organizations. We hope that natively supporting unit tests in Vector\nconfigs will preemptively solve this problem."),Object(o.b)("h2",{id:"getting-started"},"Getting Started"),Object(o.b)("p",null,"To help you get started we put together two documentation pages:"),Object(o.b)("ol",null,Object(o.b)("li",{parentName:"ol"},Object(o.b)("a",Object(r.a)({parentName:"li"},{href:"/docs/setup/guides/unit-testing/"}),"A unit testing guide")),Object(o.b)("li",{parentName:"ol"},Object(o.b)("a",Object(r.a)({parentName:"li"},{href:"/docs/reference/tests/"}),"A reference of the unit testing config spec"))),Object(o.b)("p",null,"These should be everything you need and will be actively maintained as this\nfeature matures."),Object(o.b)("h2",{id:"feedback"},"Feedback"),Object(o.b)("p",null,"We're eager to hear your feedback! Unit testing, as a ",Object(o.b)("inlineCode",{parentName:"p"},"beta")," feature, is still\nin an early phase and we need case studies and comments in order to ensure it\nworks well for everyone. Please let us know what you think either in our\n",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://chat.vector.dev/"}),"community chat")," or by\n",Object(o.b)("a",Object(r.a)({parentName:"p"},{href:"https://github.com/timberio/vector/issues/new"}),"raising an issue"),"."))}f.isMDXComponent=!0},254:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return m}));var r=n(0),a=n.n(r);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=a.a.createContext({}),p=function(e){var t=a.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s({},t,{},e)),n},u=function(e){var t=p(e.components);return a.a.createElement(l.Provider,{value:t},e.children)},f="mdxType",b={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},d=Object(r.forwardRef)((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),u=p(n),f=r,d=u["".concat(i,".").concat(f)]||u[f]||b[f]||o;return n?a.a.createElement(d,s({ref:t},l,{components:n})):a.a.createElement(d,s({ref:t},l))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[f]="string"==typeof e?e:r,i[1]=s;for(var l=2;l<o;l++)i[l]=n[l];return a.a.createElement.apply(null,i)}return a.a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},256:function(e,t,n){"use strict";var r=n(0),a=n.n(r);n(85);t.a=function({fileName:e,links:t}){let n=[];for(var r in t)n.push(a.a.createElement("a",{href:r.href},r.text||"Learn more&hellip;"));return a.a.createElement("div",{className:"code-header"},n.length>0&&a.a.createElement("span",{className:"code-header--links"},n),e)}}}]);