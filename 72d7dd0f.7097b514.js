(window.webpackJsonp=window.webpackJsonp||[]).push([[73],{173:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"metadata",(function(){return l})),n.d(t,"rightToc",(function(){return d})),n.d(t,"default",(function(){return m}));var r=n(1),o=n(6),a=(n(0),n(254)),i=n(276),s=n.n(i),c={title:"Vector as an Agent",sidebar_label:"Agent",description:"Deploying and running Vector as an agent"},l={id:"setup/deployment/roles/agent",title:"Vector as an Agent",description:"Deploying and running Vector as an agent",source:"@site/docs/setup/deployment/roles/agent.md",permalink:"/docs/setup/deployment/roles/agent",editUrl:"https://github.com/timberio/vector/edit/master/website/docs/setup/deployment/roles/agent.md",sidebar_label:"Agent",sidebar:"docs",previous:{title:"Vector Deployment Roles",permalink:"/docs/setup/deployment/roles"},next:{title:"Vector as a Service",permalink:"/docs/setup/deployment/roles/service"}},d=[{value:"Vector Configuration",id:"vector-configuration",children:[{value:"Collecting Data",id:"collecting-data",children:[]},{value:"Sending Data",id:"sending-data",children:[]}]},{value:"System Configuration",id:"system-configuration",children:[{value:"Limiting Resources",id:"limiting-resources",children:[]}]},{value:"Administration",id:"administration",children:[{value:"Configuration Changes",id:"configuration-changes",children:[]},{value:"Updating Vector",id:"updating-vector",children:[]}]}],u={rightToc:d},p="wrapper";function m(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(a.b)(p,Object(r.a)({},u,n,{components:t,mdxType:"MDXLayout"}),Object(a.b)(s.a,{src:"/img/roles-agent.svg",mdxType:"SVG"}),Object(a.b)("p",null,"When Vector serves as an agent, its purpose is to efficiently and quietly\ncollect data. In this scenario, Vector is typically sharing a host with a more\nimportant service. Therefore, it is critically important that Vector is a good\ncitizen, limiting its resource usage and efficiently forwarding data."),Object(a.b)("h2",{id:"vector-configuration"},"Vector Configuration"),Object(a.b)("h3",{id:"collecting-data"},"Collecting Data"),Object(a.b)("h4",{id:"in-a-container-context"},"In a container context"),Object(a.b)("p",null,"If you're deploying Vector in a ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/setup/installation/containers/"}),"container context"),", such as\n",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/setup/installation/containers/docker/"}),"Docker"),", then data collection is handled for you as\npart of installation, please proceed to the next section."),Object(a.b)("h4",{id:"not-in-a-container-context"},"Not in a container context"),Object(a.b)("p",null,"If you are not deploying Vector in a container context, then data collection\nmust be achieved through more generic means, such as ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://www.freedesktop.org/software/systemd/man/systemd-journald.service.html"}),"journald"),",\na ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/reference/sources/file/"}),"file"),", or ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/reference/sources/stdin/"}),"stdin"),". The method you use\ndepends on your setup. In general, we recommend avoiding stdin unless reducing\ndisk usage is top priority. Stdin is limiting, in that it is coupled with a\nsingle input stream, meaning you cannot restart Vector independently, and you\ncannot accept data from multiple streams at the same time. This makes it more\ndifficult to manage."),Object(a.b)("h3",{id:"sending-data"},"Sending Data"),Object(a.b)("h4",{id:"forwarding-to-a-downstream-vector-service"},"Forwarding to a downstream Vector service"),Object(a.b)("p",null,"If you're forwarding data to a downstream ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/setup/deployment/roles/service/"}),"Vector service"),",\nthen you should use the ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/reference/sinks/vector/"}),Object(a.b)("inlineCode",{parentName:"a"},"vector")," sink"),". The downstream\nVector service should use the ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/reference/sources/vector/"}),Object(a.b)("inlineCode",{parentName:"a"},"vector")," source"),". This\nhandles communication between Vector instances."),Object(a.b)("h4",{id:"not-forwarding-to-a-downstream-vector-service"},"Not forwarding to a downstream Vector service"),Object(a.b)("p",null,"If you are not forwarding data to a downstream Vector service then you can\nchoose ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/reference/sinks/"}),"any sink you'd like"),", but be cognizant of how many sinks\nyou're using, as more sinks usually means more resource usage. If you find\nthat Vector is hogging resources, then you should provision additional\nresources, or consider a ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/setup/deployment/topologies/#centralized"}),"centralized")," or\n",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/setup/deployment/topologies/#stream-based"}),"stream-based")," topology to push resource usage\ndownstream."),Object(a.b)("h4",{id:"hybrid-forwarding"},"Hybrid forwarding"),Object(a.b)("p",null,"There is nothing that prevents you from sending data to both a downstream\nVector service and another independent service. Often times this makes the\nmost sense if the downstream service is designed for streaming, as it takes\nload off of the downstream Vector service. For example, you might want to take\nadvantage of ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"https://cloud.google.com/bigquery/streaming-data-into-bigquery"}),"Big Query's streaming inserts"),". This\nfeature is designed for rapid streaming and it has the added benefit of making\ndata quickly available for querying. To implement this, you can forgo using a\ncentralized Vector service entirely and stream data directly from your client\nnodes."),Object(a.b)("h2",{id:"system-configuration"},"System Configuration"),Object(a.b)("h3",{id:"limiting-resources"},"Limiting Resources"),Object(a.b)("p",null,"Vector is designed to be ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"/#performance"}),Object(a.b)("em",{parentName:"a"},"highly")," efficient"),", but this does\nnot preclude Vector from consuming an excess amount of resources in certain\nscenarios. This is not ideal as an agent where priority should be given to the\nprimary service on the host. Therefore, it is recommended to limit Vector\nresource usage. We strongly believe resource limiting should be achieved at\nhigher levels, and depending on your platform this can be achieved through a\nvariety of means. For example:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",Object(r.a)({parentName:"li"},{href:"https://www.freedesktop.org/software/systemd/man/systemd.resource-control.html"}),"Limiting resources with Systemd")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",Object(r.a)({parentName:"li"},{href:"https://the.binbashtheory.com/control-resources-cgroups/"}),"Limiting resources with cgroups")),Object(a.b)("li",{parentName:"ul"},Object(a.b)("a",Object(r.a)({parentName:"li"},{href:"https://kubernetes.io/docs/tasks/configure-pod-container/assign-cpu-resource/"}),"Limiting resources with Kubernetes"))),Object(a.b)("p",null,"If none of the above links are relevant, please refer to your platform's\ndocumentation on limiting resources."),Object(a.b)("h4",{id:"resource-limit-recommendations"},"Resource limit recommendations"),Object(a.b)("p",null,"In general, we recommend the following ",Object(a.b)("em",{parentName:"p"},"minimum")," limitations:"),Object(a.b)("ul",null,Object(a.b)("li",{parentName:"ul"},"At least 5% CPU"),Object(a.b)("li",{parentName:"ul"},"At least 256mb of memory")),Object(a.b)("p",null,"A good resource manager will allow Vector to use more CPU and memory when\navailable. You should not have to provide any additional limitations."),Object(a.b)("h2",{id:"administration"},"Administration"),Object(a.b)("h3",{id:"configuration-changes"},"Configuration Changes"),Object(a.b)("p",null,"Vector can be ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/administration/process-management/#reloading"}),"reloaded")," to apply configuration changes.\nThis is the recommended strategy and should be used instead of restarting\nwhenever possible."),Object(a.b)("h3",{id:"updating-vector"},"Updating Vector"),Object(a.b)("p",null,"To ",Object(a.b)("a",Object(r.a)({parentName:"p"},{href:"/docs/administration/updating/"}),"update")," Vector you'll need to restart the process. This\nis why we recommend using sources that use the disk as a buffer, as it decouples\nthe Vector process from the source process. This allows other processes to\ncontinue running while Vector restarts. When Vector is restarted, it can resume\nwhere it left off."))}m.isMDXComponent=!0},254:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return h}));var r=n(0),o=n.n(r);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=o.a.createContext({}),d=function(e){var t=o.a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s({},t,{},e)),n},u=function(e){var t=d(e.components);return o.a.createElement(l.Provider,{value:t},e.children)},p="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},b=Object(r.forwardRef)((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,i=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),u=d(n),p=r,b=u["".concat(i,".").concat(p)]||u[p]||m[p]||a;return n?o.a.createElement(b,s({ref:t},l,{components:n})):o.a.createElement(b,s({ref:t},l))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=b;var s={};for(var c in t)hasOwnProperty.call(t,c)&&(s[c]=t[c]);s.originalType=e,s[p]="string"==typeof e?e:r,i[1]=s;for(var l=2;l<a;l++)i[l]=n[l];return o.a.createElement.apply(null,i)}return o.a.createElement.apply(null,n)}b.displayName="MDXCreateElement"}}]);